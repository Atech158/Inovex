{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Prompt Rule Schemas",
  "description": "JSON schemas for storing and validating prompt rules and configurations",

  "definitions": {
    "verbosityLevels": {
      "type": "object",
      "properties": {
        "minimal": { "type": "string", "description": "Ultra-concise rule text (20-50 tokens)" },
        "standard": { "type": "string", "description": "Standard rule text (50-150 tokens)" },
        "detailed": { "type": "string", "description": "Comprehensive rule text (150+ tokens)" }
      },
      "required": ["minimal", "standard", "detailed"],
      "additionalProperties": false
    },

    "intentCategory": {
      "type": "string",
      "enum": [
        "create-project",
        "add-feature",
        "fix-bug",
        "refactor-code",
        "database-ops",
        "design-ui",
        "explain-code",
        "deploy-config",
        "add-tests",
        "general-discuss"
      ]
    },

    "providerCategory": {
      "type": "string",
      "enum": ["high-context", "reasoning", "speed-optimized", "local-models", "coding-specialized", "standard"]
    },

    "ruleCategory": {
      "type": "string",
      "enum": [
        "webcontainer_constraints",
        "technology_preferences",
        "project_context_detection",
        "artifact_creation",
        "dependency_management",
        "database_safety",
        "code_quality",
        "security_guidelines",
        "performance_guidelines"
      ]
    }
  },

  "type": "object",
  "properties": {
    "rules": {
      "type": "object",
      "description": "Core rule definitions with verbosity levels",
      "patternProperties": {
        "^[a-z_]+$": {
          "$ref": "#/definitions/verbosityLevels"
        }
      },
      "additionalProperties": false
    },

    "shorthandSchemas": {
      "type": "object",
      "description": "Ultra-compressed rule shortcuts",
      "patternProperties": {
        "^[a-z_]+$": {
          "type": "string",
          "maxLength": 50
        }
      },
      "additionalProperties": false
    },

    "intentRuleMappings": {
      "type": "object",
      "description": "Maps intents to required and optional rule categories",
      "patternProperties": {
        "^[a-z_-]+$": {
          "type": "object",
          "properties": {
            "required": {
              "type": "array",
              "items": { "$ref": "#/definitions/ruleCategory" }
            },
            "optional": {
              "type": "array",
              "items": { "$ref": "#/definitions/ruleCategory" }
            },
            "forbidden": {
              "type": "array",
              "items": { "$ref": "#/definitions/ruleCategory" }
            }
          },
          "required": ["required"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "providerOptimizations": {
      "type": "object",
      "description": "Provider-specific optimization settings",
      "patternProperties": {
        "^[a-z-]+$": {
          "type": "object",
          "properties": {
            "tokenReduction": {
              "type": "number",
              "minimum": -50,
              "maximum": 80,
              "description": "Percentage reduction compared to standard"
            },
            "preferredVerbosity": {
              "type": "string",
              "enum": ["minimal", "standard", "detailed"]
            },
            "prioritySections": {
              "type": "array",
              "items": { "$ref": "#/definitions/ruleCategory" }
            },
            "excludedSections": {
              "type": "array",
              "items": { "$ref": "#/definitions/ruleCategory" }
            },
            "simplifyLanguage": {
              "type": "boolean"
            },
            "enhanceCodeGuidelines": {
              "type": "boolean"
            }
          },
          "required": ["tokenReduction", "preferredVerbosity"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "contextualRules": {
      "type": "object",
      "description": "Context-specific rule variations",
      "properties": {
        "supabase": {
          "type": "object",
          "properties": {
            "notConnected": { "$ref": "#/definitions/verbosityLevels" },
            "noProject": { "$ref": "#/definitions/verbosityLevels" },
            "connected": { "$ref": "#/definitions/verbosityLevels" }
          },
          "required": ["notConnected", "noProject", "connected"],
          "additionalProperties": false
        },
        "design": {
          "type": "object",
          "properties": {
            "simple": { "$ref": "#/definitions/verbosityLevels" },
            "moderate": { "$ref": "#/definitions/verbosityLevels" },
            "complex": { "$ref": "#/definitions/verbosityLevels" }
          },
          "required": ["simple", "moderate", "complex"],
          "additionalProperties": false
        }
      },
      "additionalProperties": {
        "type": "object",
        "patternProperties": {
          "^[a-z_]+$": { "$ref": "#/definitions/verbosityLevels" }
        }
      }
    },

    "validationPatterns": {
      "type": "object",
      "description": "Regex patterns for validating generated content",
      "patternProperties": {
        "^[a-z_]+$": {
          "type": "object",
          "properties": {
            "pattern": {
              "type": "string",
              "description": "Regex pattern for validation"
            },
            "flags": {
              "type": "string",
              "pattern": "^[gimsuvy]*$",
              "description": "Regex flags"
            },
            "description": {
              "type": "string",
              "description": "Human-readable description of what this pattern validates"
            },
            "severity": {
              "type": "string",
              "enum": ["error", "warning", "info"]
            }
          },
          "required": ["pattern", "description"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },

    "tokenEstimates": {
      "type": "object",
      "description": "Token count estimates for different rule combinations",
      "patternProperties": {
        "^[a-z_]+$": {
          "type": "object",
          "properties": {
            "minimal": { "type": "number", "minimum": 0 },
            "standard": { "type": "number", "minimum": 0 },
            "detailed": { "type": "number", "minimum": 0 }
          },
          "required": ["minimal", "standard", "detailed"],
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },

  "required": ["rules", "shorthandSchemas", "intentRuleMappings", "providerOptimizations"],
  "additionalProperties": false
}
